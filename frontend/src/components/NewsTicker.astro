---
// Fallback news items (used if API is unavailable)
const fallbackNews = [
  { text: "ğŸ“ New Industry Partnership: TTPOA collaborates with 50+ Fortune 500 companies for campus placements", link: `${import.meta.env.BASE_URL}/services/` },
  { text: "ğŸ“¢ Upcoming Workshop: Advanced Interview Preparation scheduled for March 2026", link: `${import.meta.env.BASE_URL}/services/` },
  { text: "ğŸ† Achievement: 95% placement success rate recorded in 2025-26 academic year", link: `${import.meta.env.BASE_URL}/about/` },
  { text: "ğŸ’¼ Job Fair Alert: Mega recruitment drive on March 15, 2026 - Register Now!", link: `${import.meta.env.BASE_URL}/contact/` },
  { text: "ğŸŒŸ Scholarship Announcement: Merit-based scholarships available for eligible students", link: `${import.meta.env.BASE_URL}/services/` },
];
---

<div class="news-ticker-wrapper border-b-2 shadow-lg" style="background: var(--color-ticker-bg); border-bottom-color: var(--color-ticker-border);">
  <div class="w-full flex items-center">
    <div class="ticker-label px-6 py-3 font-bold text-sm uppercase tracking-wide flex items-center gap-2 shadow-lg" style="background-color: var(--color-ticker-label-bg); color: var(--color-ticker-label-text);">
      <svg class="w-4 h-4 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/>
      </svg>
      Latest Updates
    </div>
    <div class="ticker-content flex-1 overflow-hidden py-3">
      <div class="ticker-scroll flex gap-12 animate-ticker" id="tickerScrollContainer">
        {fallbackNews.map((item) => (
          <a href={item.link} class="ticker-link text-sm font-medium whitespace-nowrap flex items-center gap-2">
            {item.text}
          </a>
        ))}
        {fallbackNews.map((item) => (
          <a href={item.link} class="ticker-link text-sm font-medium whitespace-nowrap flex items-center gap-2">
            {item.text}
          </a>
        ))}
      </div>
    </div>
  </div>
</div>

<script>
  // Dynamically load news ticker from backend API
  (async function loadDynamicTicker() {
    try {
      const API_BASE = window.TTPOA_API_BASE || 'http://localhost:3001';
      const res = await fetch(`${API_BASE}/api/news-ticker`);
      if (!res.ok) return;
      const items = await res.json();
      if (!items || items.length === 0) return;

      const container = document.getElementById('tickerScrollContainer');
      if (!container) return;

      // Build ticker HTML (duplicate for seamless scroll)
      const buildLinks = (newsItems) => newsItems.map(item =>
        `<a href="${item.link || '#'}" class="ticker-link text-sm font-medium whitespace-nowrap flex items-center gap-2">${item.text}</a>`
      ).join('');

      container.innerHTML = buildLinks(items) + buildLinks(items);
    } catch (e) {
      // Fallback items already rendered server-side
    }
  })();
</script>

<style>
  .news-ticker-wrapper {
    position: sticky;
    top: 4rem; /* Below navbar */
    z-index: 40;
  }

  @media (min-width: 1024px) {
    .news-ticker-wrapper {
      top: 5rem;
    }
  }

  .ticker-content {
    position: relative;
  }

  .ticker-scroll {
    display: inline-flex;
    animation: scroll-left 120s linear infinite;
  }

  .ticker-scroll:hover {
    animation-play-state: paused;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
</style>

<style is:global>
  .ticker-link {
    color: var(--color-ticker-text, white);
    transition: color 0.25s ease, text-shadow 0.25s ease;
  }
  .ticker-link:hover {
    color: #f97316 !important;
    text-shadow: 0 0 14px rgba(249, 115, 22, 0.45);
  }
</style>
